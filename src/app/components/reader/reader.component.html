<!-- Reader Container: Full screen, black background for optimal reading -->
<div class="reader-container">
  <!-- Loading State -->
  <div *ngIf="loading$ | async" class="reader-state">
    <div class="spinner spinner-light h-16 w-16"></div>
    <p class="loading-text">Loading page...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="(error$ | async) && !(loading$ | async)" class="reader-state">
    <div class="error-card">
      <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <p class="error-message">{{ error$ | async }}</p>
      <button (click)="exitReader()" class="btn-primary">Go Back</button>
    </div>
  </div>

  <!-- Reader Content -->
  <div *ngIf="!(loading$ | async) && !(error$ | async)" class="reader-content">
    
    <!-- Top Control Bar -->
    <div class="control-bar control-bar-top" 
         [class.control-hidden]="!(showControls$ | async)">
      <div class="control-bar-content">
        <!-- Exit Button -->
        <button (click)="exitReader()" class="control-button exit-button" aria-label="Exit reader">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
          <span class="button-text">Exit</span>
        </button>

        <!-- Chapter Info -->
        <div class="info-badge">
          <span class="info-text">Reading</span>
        </div>

        <!-- Page Counter -->
        <div class="info-badge page-counter">
          <span class="current-page">{{ currentPage }}</span>
          <span class="separator">/</span>
          <span class="total-pages">{{ totalPages }}</span>
        </div>
      </div>
    </div>

    <!-- Main Image Area - Fully Centered -->
    <div class="image-container">
      <img
        [src]="currentPageUrl"
        [alt]="'Page ' + currentPage"
        class="manga-page"
        crossorigin="anonymous"
        (load)="loading$.next(false)"
        (error)="error$.next('Failed to load page')"
      />
    </div>

    <!-- Side Navigation Zones -->
    <div class="nav-zones">
      <!-- Left Navigation Zone -->
      <button
        *ngIf="hasPreviousPage"
        (click)="previousPage(); $event.stopPropagation()"
        class="nav-zone nav-zone-left"
        aria-label="Previous page">
        <div class="nav-indicator">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
          </svg>
        </div>
      </button>

      <!-- Center Zone - Click to toggle controls -->
      <div class="nav-zone nav-zone-center"></div>

      <!-- Right Navigation Zone -->
      <button
        *ngIf="hasNextPage"
        (click)="nextPage(); $event.stopPropagation()"
        class="nav-zone nav-zone-right"
        aria-label="Next page">
        <div class="nav-indicator">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" />
          </svg>
        </div>
      </button>
    </div>

    <!-- Bottom Control Bar -->
    <div class="control-bar control-bar-bottom"
         [class.control-hidden]="!(showControls$ | async)">
      <div class="control-bar-content">
        <!-- Navigation Controls -->
        <div class="navigation-controls">
          <button
            (click)="previousPage(); $event.stopPropagation()"
            [disabled]="!hasPreviousPage"
            class="nav-button"
            aria-label="Previous page">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7" />
            </svg>
          </button>

          <!-- Page Input -->
          <div class="page-input-container">
            <input
              type="number"
              [value]="currentPage"
              (change)="goToPage(+$any($event.target).value); $event.stopPropagation()"
              (click)="$event.stopPropagation()"
              min="1"
              [max]="totalPages"
              class="page-input"
              aria-label="Current page"
            />
            <span class="page-separator">/</span>
            <span class="page-total">{{ totalPages }}</span>
          </div>

          <button
            (click)="nextPage(); $event.stopPropagation()"
            [disabled]="!hasNextPage"
            class="nav-button"
            aria-label="Next page">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>

        <!-- Keyboard Shortcuts -->
        <div class="shortcuts">
          <span class="shortcut-badge">← → Navigate</span>
          <span class="shortcut-separator">•</span>
          <span class="shortcut-badge">H Toggle UI</span>
          <span class="shortcut-separator">•</span>
          <span class="shortcut-badge">ESC Exit</span>
        </div>
      </div>
    </div>
  </div>
</div>
